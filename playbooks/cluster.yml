- hosts: all
  user: cloud
  sudo: true
  vars_files:
  - vars/default.yml
  tasks:
  - action: selinux state=permissive policy=targeted
  - action: selinux state=disabled policy=targeted
  - include: tasks/puppet-client.yml
  - action: shell puppet resource host puppet ip=$master_ip
  handlers:
  - include: handlers/services.yml

- hosts: master
  user: cloud
  sudo: true
  tasks:
  - include: tasks/webserver.yml
  handlers:
  - include: handlers/services.yml

- hosts: master
  user: cloud
  sudo: true
  tags:
  - postweb
  tasks:
  - include: tasks/puppet-master.yml
  - action: copy src=files/master/iptables dest=/etc/sysconfig/iptables
    notify: restart iptables
  handlers:
  - include: handlers/services.yml

